<!-- HTML for static distribution bundle build -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tapdata API Explorer</title>
  <link rel="icon" type="image/x-icon" href="./favicon.ico" />
  <!-- Bootstrap core CSS -->
  <link href="./css/bootstrap.min.css" rel="stylesheet">
  <link href="./css/loopback.css" rel="stylesheet">
  <!--Swagger UI CSS-->
  <link rel="stylesheet" type="text/css" href="./swagger-ui.css" >
  <!-- Style Overrides -->
  <style>
    html {
        box-sizing: border-box;
        overflow: -moz-scrollbars-vertical;
        overflow-y: scroll;
    }

    *,
    *:before,
    *:after {
        box-sizing: inherit;
    }

    body {
        margin:0;
        background: #fafafa;
    }

    section {
        padding: 0px;
    }

    h2 {
        line-height: initial;
        font-weight: initial;
    }

    .information-container.wrapper {
        padding-top: 30px;
    }

    .swagger-ui .col {
        width: initial;
        position: initial;
        min-height: initial;
    }

    .custom-container-wrap {
      position: absolute;
      top: 30px;
      width: 100%;
    }
    .custom-container {
      max-width: 1460px;
      margin: 0 auto;
      text-align: right;
      z-index: 10000;
    }
    .custom-container .servers>label{
      margin-right: 0;
    }
  </style>

  <!-- Site Analytics -->
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('set', 'anonymizeIp', true);
    gtag('config', 'UA-125843766-4');
  </script>
</head>

<body>
<!-- Navbar -->
<!-- <nav class="navbar navbar-expand-lg navbar-light fixed-top">
  <a class="navbar-brand" href="/#">

  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
      aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
  </div>
</nav> -->

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="position:absolute;width:0;height:0">
  <defs>
    <symbol viewBox="0 0 20 20" id="unlocked">
          <path d="M15.8 8H14V5.6C14 2.703 12.665 1 10 1 7.334 1 6 2.703 6 5.6V6h2v-.801C8 3.754 8.797 3 10 3c1.203 0 2 .754 2 2.199V8H4c-.553 0-1 .646-1 1.199V17c0 .549.428 1.139.951 1.307l1.197.387C5.672 18.861 6.55 19 7.1 19h5.8c.549 0 1.428-.139 1.951-.307l1.196-.387c.524-.167.953-.757.953-1.306V9.199C17 8.646 16.352 8 15.8 8z"></path>
    </symbol>

    <symbol viewBox="0 0 20 20" id="locked">
      <path d="M15.8 8H14V5.6C14 2.703 12.665 1 10 1 7.334 1 6 2.703 6 5.6V8H4c-.553 0-1 .646-1 1.199V17c0 .549.428 1.139.951 1.307l1.197.387C5.672 18.861 6.55 19 7.1 19h5.8c.549 0 1.428-.139 1.951-.307l1.196-.387c.524-.167.953-.757.953-1.306V9.199C17 8.646 16.352 8 15.8 8zM12 8H8V5.199C8 3.754 8.797 3 10 3c1.203 0 2 .754 2 2.199V8z"/>
    </symbol>

    <symbol viewBox="0 0 20 20" id="close">
      <path d="M14.348 14.849c-.469.469-1.229.469-1.697 0L10 11.819l-2.651 3.029c-.469.469-1.229.469-1.697 0-.469-.469-.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-.469-.469-.469-1.228 0-1.697.469-.469 1.228-.469 1.697 0L10 8.183l2.651-3.031c.469-.469 1.228-.469 1.697 0 .469.469.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c.469.469.469 1.229 0 1.698z"/>
    </symbol>

    <symbol viewBox="0 0 20 20" id="large-arrow">
      <path d="M13.25 10L6.109 2.58c-.268-.27-.268-.707 0-.979.268-.27.701-.27.969 0l7.83 7.908c.268.271.268.709 0 .979l-7.83 7.908c-.268.271-.701.27-.969 0-.268-.269-.268-.707 0-.979L13.25 10z"/>
    </symbol>

    <symbol viewBox="0 0 20 20" id="large-arrow-down">
      <path d="M17.418 6.109c.272-.268.709-.268.979 0s.271.701 0 .969l-7.908 7.83c-.27.268-.707.268-.979 0l-7.908-7.83c-.27-.268-.27-.701 0-.969.271-.268.709-.268.979 0L10 13.25l7.418-7.141z"/>
    </symbol>


    <symbol viewBox="0 0 24 24" id="jump-to">
      <path d="M19 7v4H5.83l3.58-3.59L8 6l-6 6 6 6 1.41-1.41L5.83 13H21V7z"/>
    </symbol>

    <symbol viewBox="0 0 24 24" id="expand">
      <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
    </symbol>

  </defs>
</svg>

<div class="custom-container-wrap swagger-ui">
  <div class="custom-container">
    <section class="servers wrapper block col-12"><span class="servers-title generate_code"></span>
      <div class="servers">
        <label for="codes">
          <select id="codes">
            <option value="" class="choose_option"></option>
            <!-- <option value="ada">ada</option> -->
            <!-- <option value="android">android</option> -->
            <!-- <option value="apex">apex</option>
            <option value="bash">bash</option>
            <option value="c">c</option>
            <option value="clojure">clojure</option>
            <option value="cpp-qt5-client">cpp-qt5-client</option>
            <option value="cpp-restsdk">cpp-restsdk</option>
            <option value="cpp-tizen">cpp-tizen</option> -->
<!--            <option value="csharp">C#</option>-->
            <!-- <option value="csharp-dotnet2">csharp-dotnet2</option>
            <option value="csharp-refactor">csharp-refactor</option>
            <option value="dart">dart</option>
            <option value="dart-jaguar">dart-jaguar</option>
            <option value="eiffel">eiffel</option>
            <option value="elixir">elixir</option>
            <option value="elm">elm</option>
            <option value="erlang-client">erlang-client</option>
            <option value="erlang-proper">erlang-proper</option>
            <option value="flash">flash</option>
            <option value="go">go</option>
            <option value="groovy">groovy</option>
            <option value="haskell-http-client">haskell-http-client</option> -->
            <option value="java">Java</option>
<!--            <option value="javascript">Javascript-Node.js</option>-->
            <!-- <option value="javascript-closure-angular">javascript-closure-angular</option>
            <option value="javascript-flowtyped">javascript-flowtyped</option>
            <option value="jaxrs-cxf-client">jaxrs-cxf-client</option>
            <option value="jmeter">jmeter</option>
            <option value="kotlin">kotlin</option>
            <option value="lua">lua</option>
            <option value="objc">objc</option>
            <option value="perl">perl</option>
            <option value="php">php</option>
            <option value="powershell">powershell</option> -->
<!--            <option value="python">Python</option>-->
            <!-- <option value="r">r</option>
            <option value="ruby">ruby</option>
            <option value="rust">rust</option>
            <option value="scala-akka">scala-akka</option>
            <option value="scala-gatling">scala-gatling</option>
            <option value="scala-httpclient">scala-httpclient</option>
            <option value="scalaz">scalaz</option>
            <option value="swift2-deprecated">swift2-deprecated</option>
            <option value="swift3-deprecated">swift3-deprecated</option>
            <option value="swift4">swift4</option>
            <option value="typescript-angular">typescript-angular</option>
            <option value="typescript-angularjs">typescript-angularjs</option>
            <option value="typescript-aurelia">typescript-aurelia</option>
            <option value="typescript-axios">typescript-axios</option>
            <option value="typescript-fetch">typescript-fetch</option>
            <option value="typescript-inversify">typescript-inversify</option>
            <option value="typescript-jquery">typescript-jquery</option>
            <option value="typescript-node">typescript-node</option>
            <option value="typescript-rxjs">typescript-rxjs</option> -->
          </select>
        </label>
      </div>
    </section>
  </div>
</div>
<div id="swagger-ui"></div>

<script src="./swagger-ui-bundle.js"> </script>
<script src="./swagger-ui-standalone-preset.js"> </script>
<script src="js/jquery-3.3.1.min.js"></script>
<!-- Bootstrap core JavaScript -->
<script src="js/bootstrap.min.js"></script>

<script>
  // function onchange(params) {
  //   console.log(params);
  //   debugger;

  // }
  $(document).ready(function(){
    function getCode(key,name) {
      // var i18n =  parent.window.jQuery.i18n
      return parent && parent.window && parent.window.jQuery && parent.window.jQuery.i18n ? (parent.window.jQuery.i18n.map[key] || name) : name
    }

    $(".generate_code").text(getCode('FileTest.generate_code','FileTest.generate_code'));
    $(".choose_option").text(getCode('FileTest.choose_option','FileTest.choose_option'));
    
  })
  
  window.onload = function() {
    const selectElement = document.querySelector('#codes');

    selectElement.addEventListener('change', (event) => {
      // const result = document.querySelector('.result');
      let lan = event.target.value;
      if (lan === "") {
        return;
      }
      console.log(`You like ${lan}`);
      //$.get("http://127.0.0.1:3030/api/sdk_codegen?lan=java&oas=http://127.0.0.1:3080/openapi.json",null);
      let oas = document.querySelector('#swagger-ui > section > div.swagger-ui > div:nth-child(2) > div.information-container.wrapper > section > div > div > hgroup > a').href;
      // window.location.href = `/api/sdk_codegen?lan=${lan}&oas=${oas}`;
      top.open(`/api/sdk_codegen?lan=${lan}&oas=${oas}`);

    });


    function errorHaneldr(resp, type, msg){

      alert( resp.status + ' ' + msg + '\n' + resp.responseText)

      window.close()
    }

    function getClientInfo(successCallback, errorCallback) {
      $.ajax({
        url: '/api/Applications/findOne',
        dataType: 'json',
        data: {
          'filter[where][clientName]': 'api-server'
        },
        success: successCallback,
        error: errorCallback || errorHaneldr
      })
    }

    function getTokenByClientCredentials(clientId, clientSecret, grant_type, username, scope, successCallback, errorCallback) {
      scope = scope || 'demo';
      var data = 'grant_type=' + grant_type + '&client_id=' + clientId
        + '&client_secret=' + clientSecret + '&scope=' + scope;

      if (username)
        data += '&username=' + username;

      const tokenEndpoint = '/oauth/token';

      $.ajax({
        url: tokenEndpoint,
        dataType: 'json',
        data: data,
        success: successCallback,
        method: 'POST',
        error: errorCallback || errorHaneldr
      })
    }

    function getTag(){
      let hashs = (location.hash||'').split('/')
      if( hashs && hashs.length > 1)
        return hashs[1]
      return true
    }

    function initSwaggerUI(data) {
      let ui = SwaggerUIBundle({
        // Default to petstore. LoopBack 4 applications will override it by setting
        // the url parameter, such as https://loopback.io/api-explorer?url=<swagger-spec-url>
        url: "//petstore.swagger.io/v2/swagger.json",
        dom_id: '#swagger-ui',
        deepLinking: true,
        filter: getTag(),
        defaultModelsExpandDepth: 0,
        defaultModelExpandDepth: 0,
        docExpansion: 'list',
        presets: [
          SwaggerUIBundle.presets.apis,
          // SwaggerUIStandalonePreset
          SwaggerUIStandalonePreset.slice(1) // Disable the top bar
        ],
        plugins: [
          SwaggerUIBundle.plugins.DownloadUrl
        ],
        layout: "StandaloneLayout",
        oauth2RedirectUrl: '/auth/token',
        requestInterceptor: function(request){

          // add oauth2 params
          if( data && data.access_token ){
            request.headers['access_token'] = data.access_token
          }

          return request;
        },

        responseInterceptor: function(response){
          return response
        }
      })
      window.ui = ui

    }

    /*getClientInfo(function(clientInfo){

      let scope = clientInfo.scopes && clientInfo.scopes[0] ? clientInfo.scopes[0] : "demo"
      let username = decodeURIComponent(document.cookie.match(/(^|)email=([^;]*)(;|$)/)[2])

      getTokenByClientCredentials(
        clientInfo.id,
        clientInfo.clientSecret,
        'client_credentials',
        username, scope,
        )
    })*/
    function getQueryString(name) {
      let reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
      let r = window.location.search.substr(1).match(reg);
      if (r != null) return unescape(r[2]);
      return null;
    }
    initSwaggerUI({access_token: getQueryString('token')})

  }
</script>
</body>

</html>
